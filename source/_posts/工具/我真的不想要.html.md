---
title: 我真的不想要.html
date: 2020-11-17 11:46:14
updated: 2020-11-19 19:00:00
tags: [Vercel,Coding,.html]
categories: 工具
description: 我是真的不喜欢.html，但是不想去麻烦小康，自己用最笨的方法解决
keywords: Vercel,Coding,.html
id: 14
cover: https://cdn.jsdelivr.net/gh/ccknbc-backup/photos/blog/2020-11-21~12-32-16.webp
top_img: false
---
top_img: https://cdn.jsdelivr.net/gh/ccknbc-backup/photos/blog/2020-11-21~12-33-27.webp

## 起因

![前往新版](https://img.gejiba.com/images/8e6374cfae11f5daa0e63b9401ac7d58.png)

于是临时解析到了Vercel，但是晚上它又好了

![旧版网站列表已恢复](https://img.gejiba.com/images/6972a68cf319f409337284b58f175533.png)

## 发现问题

但部署刷新几遍发现没有变化，当时德目录结构没有live文件夹里面放index.html，会想到主页的`.html`后缀问题，我去前往主页分页查看，果然不加`.html`直接公益404，那么就得为两种解析方式都准备好源文件

![Coding和Vercel不同的解析导致](https://img.gejiba.com/images/1228b50ad5e3ba050e00043cfebbf78e.png)

## 解决问题

![假装解决](https://img.gejiba.com/images/2ae5a720973f2fa7b9eefa499da82098.png)

## 主页怎么办

![同样的问题](https://img.gejiba.com/images/876e07cf720f8d10031ec0d50fa2ad4c.png)

## 这是废话

```js
const gulp = require("gulp");
const minifycss = require("gulp-clean-css");
const uglify = require("gulp-uglify");
const htmlmin = require("gulp-htmlmin");
const cssnano = require("gulp-cssnano");
const htmlclean = require("gulp-htmlclean");
const del = require("del");
const babel = require("gulp-babel");
const autoprefixer = require("gulp-autoprefixer");
const connect = require("gulp-connect");
const pug = require("gulp-pug");
const sass = require("gulp-sass");
const rename = require("gulp-rename");
sass.compiler = require("node-sass");

const config = require("./config.json");

gulp.task("clean", function () {
	return del(["./dist/css/", "./dist/js/"]);
});

gulp.task("css", function () {
	return gulp
		.src("./src/css/*.scss")
		.pipe(sass().on("error", sass.logError))
		.pipe(minifycss({ compatibility: "ie8" }))
		.pipe(autoprefixer({ overrideBrowserslist: ["last 2 version"] }))
		.pipe(cssnano({ reduceIdents: false }))
		.pipe(gulp.dest("./dist/css"));
});

gulp.task("html", function () {
	return gulp
		.src("./dist/*.html")
		.pipe(htmlclean())
		.pipe(htmlmin())
		.pipe(gulp.dest("./dist"));
});

gulp.task("js", function () {
	return gulp
		.src("./src/js/*.js")
		.pipe(babel({ presets: ["@babel/preset-env"] }))
		.pipe(uglify())
		.pipe(gulp.dest("./dist/js"));
});

gulp.task("pug", function () {
	return gulp
		.src("./src/*.pug")
		.pipe(pug({ data: config }))
		.pipe(gulp.dest("./dist"));
});
gulp.task("redirect", function (done) {
	config.redirect.forEach((item) => {
		// item 为redirect的列表
		let data = {
			redirect: item,
			count: config.count,
			template: item.template || "redirect",
		};
		gulp
			.src(`./src/redirect/${data.template}.pug`)
			.pipe(pug({ data: data }))
			.pipe(rename("index.html"))
			.pipe(gulp.dest(`./dist/${item.path}`));
	});
	done();
});
gulp.task("assets", function () {
	return gulp.src(["./src/assets/**/*"]).pipe(gulp.dest("./dist/assets"));
});
gulp.task("staticHtml", function () {
	return gulp.src(["./src/*.html"]).pipe(gulp.dest("./dist"));
});
gulp.task("test", gulp.series("redirect"));
gulp.task("LICENSE", function () {
	return gulp.src(["./src/LICENSE"]).pipe(gulp.dest("./dist"));
});

gulp.task("txt", function () {
	return gulp.src(["./src/*.txt"]).pipe(gulp.dest("./dist"));
});

gulp.task("md", function () {
	return gulp.src(["./src/*.md"]).pipe(gulp.dest("./dist"));
});

gulp.task("sw", function () {
	return gulp.src(["./src/*.js"]).pipe(gulp.dest("./dist"));
});

gulp.task(
	"build",
	gulp.series(
		"clean",
		"assets",
		"staticHtml",
		"pug",
		"redirect",
		"css",
		"js",
		"html",
		"LICENSE",
		"txt",
		"md",
		"sw"
	)
);
gulp.task("default", gulp.series("build"));

gulp.task("watch", function () {
	gulp.watch("./src/components/*.pug", gulp.parallel("pug"));
	gulp.watch("./src/pages/*.pug", gulp.parallel("pug"));
	gulp.watch("./src/*.pug", gulp.parallel("pug"));
	gulp.watch("./src/css/**/*.scss", gulp.parallel(["css"]));
	gulp.watch("./src/js/*.js", gulp.parallel(["js"]));
	connect.server({
		root: "dist",
		livereload: true,
		port: 4000,
	});
});
```

以上仅作为存档备份，万一哪天改没了，不想去找历史记录

## 最笨的方法解决

为了保险起见，我还是要确保双目录，境内外都能正常跳转

```js
//在生成静态文件并且压缩完毕后，新建文件夹，复制过去重命名为index.html即可保证coding，vercel都能不使用.html访问了，index.html和404.html因为两边都能正常跳转，我也不会通配，所以老老实实一条一条写（乐特说只有废物看文档，我就是废物，我还不想看）
gulp.task("about", function () {
	return gulp
		.src("./dist/about.html")
		.pipe(rename("index.html"))
		.pipe(gulp.dest("./dist/about"));
});

gulp.task("link", function () {
	return gulp
		.src("./dist/link.html")
		.pipe(rename("index.html"))
		.pipe(gulp.dest("./dist/link"));
});

gulp.task("speak", function () {
	return gulp
		.src("./dist/speak.html")
		.pipe(rename("index.html"))
		.pipe(gulp.dest("./dist/speak"));
});

gulp.task("timeline", function () {
	return gulp
		.src("./dist/timeline.html")
		.pipe(rename("index.html"))
		.pipe(gulp.dest("./dist/timeline"));
});

//同时按照顺序添加任务
gulp.task(
	"build",
	gulp.series(
		"html",
		"about",
		"link",
		"speak",
		"timeline",

	)
);
```

这样生成的文件目录和预期相同

![确实达到了我的目的](https://img.gejiba.com/images/ea2bc73434006445eea3887692affa47.png)

![很开心完毕了](https://img.gejiba.com/images/4453385e1e58ee86a207f83eb3bd0236.png)

## 结果

现在主页不管是`Vercel`还是`Coding`都能正常跳转脱掉`.html`了，并且可实现境外境内分流（骗骗自己）

比如现在访问主站点直播界面，若是境外用户会显示（Vercel）

![境外用户](https://img.gejiba.com/images/c4115e5fcd45b01ab427e1381084953a.png)

但境内用户则正常(Coding)

![境内用户](https://img.gejiba.com/images/0d859ca43d11caf7c762b6b177bd7288.png)

## 分析

在逻辑上，`Vervel`,`Github`,`Gitlab`,`Gitee`一致，`Coding`,`Netlify`一致，所以上面的说法是不严谨的，但至少所有镜像站点都可以正常跳转了

接下来我就要去学习一下DNS解析的问题了